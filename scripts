#!/usr/bin/env python3
"""
Script para iniciar el servidor MAPO en modo desarrollo
"""
import subprocess
import sys
import os
from pathlib import Path

def main():
    print("=" * 50)
    print("MAPO Backend - Servidor de Desarrollo")
    print("=" * 50)
    
    # Verificar que estamos en el directorio correcto
    if not Path("main.py").exists():
        print("‚ùå Error: No se encuentra main.py")
        print("   Ejecuta este script desde el directorio backend/")
        return 1
    
    # Verificar entorno virtual
    if not Path("venv").exists():
        print("‚ùå Error: No se encuentra el entorno virtual")
        print("   Crea el entorno virtual con: python -m venv venv")
        return 1
    
    try:
        print("üîß Configurando entorno de desarrollo...")
        
        # Configurar variables de entorno m√≠nimas
        os.environ.setdefault("ENVIRONMENT", "development")
        os.environ.setdefault("DEBUG", "true")
        os.environ.setdefault("SECRET_KEY", "dev-secret-key-change-in-production")
        os.environ.setdefault("DATABASE_URL", "sqlite:///./mapo_dev.db")  # SQLite para desarrollo
        os.environ.setdefault("FIREBASE_PROJECT_ID", "desarrollo-local")
        
        print("üöÄ Iniciando servidor FastAPI...")
        print("   URL: http://localhost:8000")
        print("   Docs: http://localhost:8000/docs")
        print("   Presiona Ctrl+C para detener")
        print("-" * 50)
        
        # Ejecutar con uvicorn
        cmd = [
            sys.executable, "-m", "uvicorn",
            "main:app",
            "--host", "0.0.0.0",
            "--port", "8000",
            "--reload",
            "--log-level", "info"
        ]
        
        subprocess.run(cmd)
        
    except KeyboardInterrupt:
        print("\n‚úÖ Servidor detenido correctamente")
        return 0
    except Exception as e:
        print(f"‚ùå Error inesperado: {e}")
        return 1

if __name__ == "__main__":
    sys.exit(main())